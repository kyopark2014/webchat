@startuml callflow
skinparam class {
    BackgroundColor White
    ArrowColor Black
    BorderColor Black
    AttributeIconSize 0
}
'skinparam style strictuml
skinparam stereotypeCBackgroundColor White
skinparam stereotypeIBackgroundColor White
skinparam stereotypeEBackgroundColor White
skinparam stereotypeABackgroundColor White
skinparam linetype ortho

'title "Basic Flow 1-to-1 (PUBSUB))"
hide footbox

box "Client" #LightBlue
actor A
actor B
actor C
end box


participant IM1
participant IM2
participant IM3


database DB 

queue PUBSUB

== A, B, C were connected by socket.io == 

note over A
GroupID: generated by client
Participant List: selected by user
end note

A -> IM1 : "CREATE g1"


IM1 -> DB : save participant list

IM1 -> PUBSUB : SUBSCRIBE "g1"

note over IM1
The event for which "SUBSCRIBE" is required for "g1"
will generated by the server
end note

IM1 -> PUBSUB : PUBLISH B "subscribe required for g1" 
PUBSUB -> IM2 : "subscribe required for groupID"
IM2 -> DB ++: load participant list
return participant list
IM2 -> PUBSUB: "SUBSCRIBE g1"

IM1 -> PUBSUB : PUBLISH C "subscribe requird for g1" 
PUBSUB -> IM3 : "subscribe required for g1"
IM3 -> DB ++: load participant list
return participant list
IM3 -> PUBSUB: "SUBSCRIBE g1"

== groupchat session is ready  == 
A -> IM1 : "msg"
IM1 -> PUBSUB : PUBLISH "g1" "msg"
PUBSUB -> IM2 : "msg"
IM2 -> B : "msg"

PUBSUB -> IM3 : "msg"
IM3 -> C : "msg"
@enduml


